<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>adf_hd.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>adf_hd.c File Reference</h1>Native hard disk access functions. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include "<a class="el" href="adf__str_8h.html">adf_str.h</a>"</code><br>
<code>#include "<a class="el" href="hd__blk_8h.html">hd_blk.h</a>"</code><br>
<code>#include "<a class="el" href="adf__raw_8h.html">adf_raw.h</a>"</code><br>
<code>#include "<a class="el" href="adf__hd_8h.html">adf_hd.h</a>"</code><br>
<code>#include "<a class="el" href="adf__util_8h.html">adf_util.h</a>"</code><br>
<code>#include "<a class="el" href="adf__disk_8h.html">adf_disk.h</a>"</code><br>
<code>#include "<a class="el" href="_win32_2adf__nativ_8h.html">adf_nativ.h</a>"</code><br>
<code>#include "<a class="el" href="adf__dump_8h.html">adf_dump.h</a>"</code><br>
<code>#include "<a class="el" href="adf__err_8h.html">adf_err.h</a>"</code><br>
<code>#include "<a class="el" href="defendian_8h.html">defendian.h</a>"</code><br>

<p>
Include dependency graph for adf_hd.c:<p><center><img src="adf__hd_8c__incl.png" border="0" usemap="#adf_hd.c_map" alt="Include dependency graph"></center>
<map name="adf_hd.c_map">
<area href="adf__str_8h.html" shape="rect" coords="147,186,219,204" alt="">
<area href="hd__blk_8h.html" shape="rect" coords="273,255,345,274" alt="">
<area href="adf__raw_8h.html" shape="rect" coords="267,67,350,86" alt="">
<area href="adf__hd_8h.html" shape="rect" coords="410,312,482,331" alt="">
<area href="adf__util_8h.html" shape="rect" coords="270,115,347,134" alt="">
<area href="adf__disk_8h.html" shape="rect" coords="267,162,350,180" alt="">
<area href="adf__err_8h.html" shape="rect" coords="25,352,99,371" alt="">
<area href="_win32_2adf__nativ_8h.html" shape="rect" coords="402,491,490,510" alt="">
<area href="adf__dump_8h.html" shape="rect" coords="398,534,494,552" alt="">
<area href="defendian_8h.html" shape="rect" coords="401,576,491,595" alt="">
</map>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="adf__hd_8c.html#a2">adfDeviceInfo</a> (struct <a class="el" href="struct_device.html">Device</a> *dev)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Display information about a device and its volumes.</em> <a href="#a2"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="struct_device.html">Device</a> *&nbsp;</td><td valign=bottom><a class="el" href="adf__hd_8c.html#a7">adfMountDev</a> (char *filename, BOOL ro)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Mount a dump file (.adf) or a real device (uses <a class="el" href="_win32_2adf__nativ_8c.html">adf_nativ.c</a> and .h).</em> <a href="#a7"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>RETCODE&nbsp;</td><td valign=bottom><a class="el" href="adf__hd_8c.html#a9">adfCreateFlop</a> (struct <a class="el" href="struct_device.html">Device</a> *dev, char *volName, int volType)</td></tr>
<tr><td nowrap align=right valign=top>RETCODE&nbsp;</td><td valign=bottom><a class="el" href="adf__hd_8c.html#a10">adfCreateHd</a> (struct <a class="el" href="struct_device.html">Device</a> *dev, int n, struct <a class="el" href="struct_partition.html">Partition</a> **partList)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Create a hard disk dump.</em> <a href="#a10"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="adf__hd_8c.html#a11">adfUnMountDev</a> (struct <a class="el" href="struct_device.html">Device</a> *dev)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Dismount a device.</em> <a href="#a11"></a><em></em></font><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Native hard disk access functions.
<p>

<p>
<hr><h2>Function Documentation</h2>
<a name="a9" doxytag="adf_hd.c::adfCreateFlop"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> RETCODE adfCreateFlop </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="struct_device.html">Device</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dev</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>volName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>volType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>dev</em>&nbsp;</td><td>
-  </td></tr>
<tr><td valign=top><em>volName</em>&nbsp;</td><td>
-  </td></tr>
<tr><td valign=top><em>volType</em>&nbsp;</td><td>
-  </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
RC_OK or RC_ERROR. Creates the filesystem of a DD or HD floppy. AdfMount() must be used after to mount the only volume. In case of a new ADF dump, <a class="el" href="adf__dump_8c.html#a6">adfCreateDumpDevice()</a> must be called before to create an empty media of the right size. A floppy disk ADF dump created with ADFlib -can be- used back by the AmigaDOS.</dl><b>Internals</b>: <br>
 1. Allocation of dev-&gt;volList[]. It contains one volume.<br>
 2. Creation of the volume
<p>
<b>Examples</b>: <br>
 See <a target="top" href="../../api_device.html">api_device.html</a> for example code.     </td>
  </tr>
</table>
<a name="a10" doxytag="adf_hd.c::adfCreateHd"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> RETCODE adfCreateHd </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="struct_device.html">Device</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>dev</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>n</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="struct_partition.html">Partition</a> **&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>partList</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a hard disk dump.
<p>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>dev</em>&nbsp;</td><td>
- the device to be created. </td></tr>
<tr><td valign=top><em>n</em>&nbsp;</td><td>
- the number of partitions. </td></tr>
<tr><td valign=top><em>partList</em>&nbsp;</td><td>
- the partitions to be used. </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
 Create the filesystem of a device which will be used as a Harddisk. AdfMount() must be used afterwards to mount a volume (partition). In the case of a new ADF dump, <a class="el" href="adf__dump_8c.html#a6">adfCreateDumpDevice()</a> must be called before to create an empty medium of the right size. A Harddisk ADF dump created with ADFlib -can not be- used by AmigaDOS, since some fields of the header structures are missing : they can not be automatically determined.</dl><b>Internals</b>: <br>
 1. Creates and fills dev-&gt;volList[]<br>
 2. Creates the Harddisk header structures on the media. It usually uses the 2 first cylinders of the device.
<p>
<b>Examples</b>: <br>
 See <a target="top" href="../../api_device.html">api_device.html</a> for example code.     </td>
  </tr>
</table>
<a name="a2" doxytag="adf_hd.c::adfDeviceInfo"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void adfDeviceInfo </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="struct_device.html">Device</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>dev</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Display information about a device and its volumes.
<p>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>dev</em>&nbsp;</td><td>
- the device to query. </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
Void.</dl>The function is for demonstration purposes only since the output is stdout! It could easily be modified to use a different display medium.     </td>
  </tr>
</table>
<a name="a7" doxytag="adf_hd.c::adfMountDev"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="struct_device.html">Device</a>* adfMountDev </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>filename</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ro</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Mount a dump file (.adf) or a real device (uses <a class="el" href="_win32_2adf__nativ_8c.html">adf_nativ.c</a> and .h).
<p>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>filename</em>&nbsp;</td><td>
- the device name. </td></tr>
<tr><td valign=top><em>ro</em>&nbsp;</td><td>
- TRUE if read only access is edsired, FALSE otherwise. </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
A <a class="el" href="struct_device.html">Device</a> structure pointer or NULL if an error occurs.</dl>Mounts a device. The name could be a filename for an ADF dump, or a real device name such as "|F:" for the Win32 F: partition. The real device name is plateform dependent. adfInitDevice() must fill dev-&gt;size!
<p>
<b>Internals</b>: <br>
 1. Allocation of struct <a class="el" href="struct_device.html">Device</a> *dev. <br>
 2. Calls adfIsNativeDev() to determine if the name point out a ADF dump or a real (native) device. The field dev-&gt;isNativeDev is filled. <br>
 3. Initialize the (real or dump) device. The field dev-&gt;size is filled. <br>
 4. dev-&gt;devType is filled. <br>
 5. The device is mounted : dev-&gt;nVol, dev-&gt;volList[], dev-&gt;cylinders, dev-&gt;heads, dev-&gt;sectors are filled. <br>
 6. dev is returned.
<p>
Warning, in each dev-&gt;volList[i] volumes (vol), only vol-&gt;volName (might be NULL), vol-&gt;firstBlock, vol-&gt;lastBlock and vol-&gt;rootBlock are filled!
<p>
<b>Files</b>: <br>
 Real devices allocation : <a class="el" href="_win32_2adf__nativ_8c.html">adf_nativ.c</a>, <a class="el" href="_win32_2adf__nativ_8h.html">adf_nativ.h</a>. <br>
 ADF allocation : <a class="el" href="adf__dump_8c.html">adf_dump.c</a>, <a class="el" href="adf__dump_8h.html">adf_dump.h</a>. <dl compact><dt><b>See also: </b></dt><dd>
struct <a class="el" href="struct_device.html">Device</a>, real (native) devices. </dl>    </td>
  </tr>
</table>
<a name="a11" doxytag="adf_hd.c::adfUnMountDev"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void adfUnMountDev </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="struct_device.html">Device</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>dev</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Dismount a device.
<p>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>dev</em>&nbsp;</td><td>
- the device to dismount. </td></tr>
</table>
</dl><dl compact><dt><b>Returns: </b></dt><dd>
Void.</dl>Releases a <a class="el" href="struct_device.html">Device</a> and frees related resources.
<p>
<b>Internals</b>: <br>
 1. Frees dev-&gt;volList[].<br>
 2. Releases the ADF dump or real (native) device : call the suited function.     </td>
  </tr>
</table>
<hr><address style="align: right;"><small>Generated on Sun Nov 17 22:45:18 2002 for staticlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
