<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>adf_blk.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>adf_blk.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *  ADF Library. (C) 1997-2002 Laurent Clevy</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  adf_blk.h</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *  general blocks structures</span>
00007 <span class="comment"> */</span>
00008 
00009 
00010 <span class="preprocessor">#ifndef ADF_BLK_H</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define ADF_BLK_H 1</span>
00012 <span class="preprocessor"></span>
00013 <span class="preprocessor">#define ULONG   unsigned long</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#define USHORT  unsigned short</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define UCHAR   unsigned char</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#define LOGICAL_BLOCK_SIZE    512</span>
00018 <span class="preprocessor"></span>
00019 <span class="comment">/* ----- FILE SYSTEM ----- */</span>
00020 
00021 <span class="preprocessor">#define FSMASK_FFS         1</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define FSMASK_INTL        2</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define FSMASK_DIRCACHE    4</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#define isFFS(c)           ((c)&amp;FSMASK_FFS)</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define isOFS(c)           (!((c)&amp;FSMASK_FFS))</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define isINTL(c)          ((c)&amp;FSMASK_INTL)</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#define isDIRCACHE(c)      ((c)&amp;FSMASK_DIRCACHE)</span>
00029 <span class="preprocessor"></span>
00030 
00031 <span class="comment">/* ----- ENTRIES ----- */</span>
00032 
00033 <span class="comment">/* access constants */</span>
00034 
00035 <span class="preprocessor">#define ACCMASK_D   (1&lt;&lt;0)</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_E   (1&lt;&lt;1)</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_W   (1&lt;&lt;2)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_R   (1&lt;&lt;3)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_A   (1&lt;&lt;4)</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_P   (1&lt;&lt;5)</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_S   (1&lt;&lt;6)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define ACCMASK_H   (1&lt;&lt;7)</span>
00043 <span class="preprocessor"></span>
00044 <span class="preprocessor">#define hasD(c)    ((c)&amp;ACCMASK_D)</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define hasE(c)    ((c)&amp;ACCMASK_E)</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define hasW(c)    ((c)&amp;ACCMASK_W)</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#define hasR(c)    ((c)&amp;ACCMASK_R)</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define hasA(c)    ((c)&amp;ACCMASK_A)</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define hasP(c)    ((c)&amp;ACCMASK_P)</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define hasS(c)    ((c)&amp;ACCMASK_S)</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define hasH(c)    ((c)&amp;ACCMASK_H)</span>
00052 <span class="preprocessor"></span>
00053 
00054 <span class="comment">/* ----- BLOCKS ----- */</span>
00055 
00056 <span class="comment">/* block constants */</span>
00057 
00058 <span class="preprocessor">#define BM_VALID    -1</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define BM_INVALID  0</span>
00060 <span class="preprocessor"></span>
00061 <span class="preprocessor">#define HT_SIZE     72</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define BM_SIZE     25</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define MAX_DATABLK 72</span>
00064 <span class="preprocessor"></span>
00065 <span class="preprocessor">#define MAXNAMELEN  30</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define MAXCMMTLEN  79</span>
00067 <span class="preprocessor"></span>
00068 
00069 <span class="comment">/* block primary and secondary types */</span>
00070 
00071 <span class="preprocessor">#define T_HEADER    2</span>
00072 <span class="preprocessor"></span><span class="preprocessor">#define ST_ROOT     1</span>
00073 <span class="preprocessor"></span><span class="preprocessor">#define ST_DIR      2</span>
00074 <span class="preprocessor"></span><span class="preprocessor">#define ST_FILE     -3</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#define ST_LFILE    -4</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define ST_LDIR     4</span>
00077 <span class="preprocessor"></span><span class="preprocessor">#define ST_LSOFT    3</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#define T_LIST      16</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#define T_DATA      8</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define T_DIRC      33</span>
00081 <span class="preprocessor"></span>
00082 
00083 <span class="comment">/*--- blocks structures --- */</span>
00084 
00085 
00086 <span class="keyword">struct </span>bBootBlock {
00087 <span class="comment">/*000*/</span> <span class="keywordtype">char</span>    dosType[4];
00088 <span class="comment">/*004*/</span> ULONG   checkSum;
00089 <span class="comment">/*008*/</span> <span class="keywordtype">long</span>    rootBlock;
00090 <span class="comment">/*00c*/</span> UCHAR   data[500+512];
00091 };
00092 
00093 
00094 <span class="keyword">struct </span>bRootBlock {
00095 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;
00096         <span class="keywordtype">long</span>    headerKey;
00097         <span class="keywordtype">long</span>    highSeq;
00098 <span class="comment">/*00c*/</span> <span class="keywordtype">long</span>    hashTableSize;
00099         <span class="keywordtype">long</span>    firstData;
00100 <span class="comment">/*014*/</span> ULONG   checkSum;
00101 <span class="comment">/*018*/</span> <span class="keywordtype">long</span>    hashTable[HT_SIZE];     <span class="comment">/* hash table */</span>
00102 <span class="comment">/*138*/</span> <span class="keywordtype">long</span>    bmFlag;             <span class="comment">/* bitmap flag, -1 means VALID */</span>
00103 <span class="comment">/*13c*/</span> <span class="keywordtype">long</span>    bmPages[BM_SIZE];
00104 <span class="comment">/*1a0*/</span> <span class="keywordtype">long</span>    bmExt;
00105 <span class="comment">/*1a4*/</span> <span class="keywordtype">long</span>    cDays;  <span class="comment">/* creation date FFS and OFS */</span>
00106 <span class="comment">/*1a8*/</span> <span class="keywordtype">long</span>    cMins;
00107 <span class="comment">/*1ac*/</span> <span class="keywordtype">long</span>    cTicks;
00108 <span class="comment">/*1b0*/</span> <span class="keywordtype">char</span>    nameLen;
00109 <span class="comment">/*1b1*/</span> <span class="keywordtype">char</span>    diskName[MAXNAMELEN+1];
00110         <span class="keywordtype">char</span>    r2[8];
00111 <span class="comment">/*1d8*/</span> <span class="keywordtype">long</span>    days;       <span class="comment">/* last access : days after 1 jan 1978 */</span>
00112 <span class="comment">/*1dc*/</span> <span class="keywordtype">long</span>    mins;       <span class="comment">/* hours and minutes in minutes */</span>
00113 <span class="comment">/*1e0*/</span> <span class="keywordtype">long</span>    ticks;      <span class="comment">/* 1/50 seconds */</span>
00114 <span class="comment">/*1e4*/</span> <span class="keywordtype">long</span>    coDays; <span class="comment">/* creation date OFS */</span>
00115 <span class="comment">/*1e8*/</span> <span class="keywordtype">long</span>    coMins;
00116 <span class="comment">/*1ec*/</span> <span class="keywordtype">long</span>    coTicks;
00117         <span class="keywordtype">long</span>    nextSameHash;   <span class="comment">/* == 0 */</span>
00118         <span class="keywordtype">long</span>    parent;     <span class="comment">/* == 0 */</span>
00119 <span class="comment">/*1f8*/</span> <span class="keywordtype">long</span>    extension;      <span class="comment">/* FFS: first directory cache block */</span>
00120 <span class="comment">/*1fc*/</span> <span class="keywordtype">long</span>    secType;    <span class="comment">/* == 1 */</span>
00121 };
00122 
00123 
00124 <span class="keyword">struct </span>bFileHeaderBlock {
00125 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;       <span class="comment">/* == 2 */</span>
00126 <span class="comment">/*004*/</span> <span class="keywordtype">long</span>    headerKey;  <span class="comment">/* current block number */</span>
00127 <span class="comment">/*008*/</span> <span class="keywordtype">long</span>    highSeq;    <span class="comment">/* number of data block in this hdr block */</span>
00128 <span class="comment">/*00c*/</span> <span class="keywordtype">long</span>    dataSize;   <span class="comment">/* == 0 */</span>
00129 <span class="comment">/*010*/</span> <span class="keywordtype">long</span>    firstData;
00130 <span class="comment">/*014*/</span> ULONG   checkSum;
00131 <span class="comment">/*018*/</span> <span class="keywordtype">long</span>    dataBlocks[MAX_DATABLK];
00132 <span class="comment">/*138*/</span> <span class="keywordtype">long</span>    r1;
00133 <span class="comment">/*13c*/</span> <span class="keywordtype">long</span>    r2;
00134 <span class="comment">/*140*/</span> <span class="keywordtype">long</span>    access; <span class="comment">/* bit0=del, 1=modif, 2=write, 3=read */</span>
00135 <span class="comment">/*144*/</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   byteSize;
00136 <span class="comment">/*148*/</span> <span class="keywordtype">char</span>    commLen;
00137 <span class="comment">/*149*/</span> <span class="keywordtype">char</span>    comment[MAXCMMTLEN+1];
00138         <span class="keywordtype">char</span>    r3[91-(MAXCMMTLEN+1)];
00139 <span class="comment">/*1a4*/</span> <span class="keywordtype">long</span>    days;
00140 <span class="comment">/*1a8*/</span> <span class="keywordtype">long</span>    mins;
00141 <span class="comment">/*1ac*/</span> <span class="keywordtype">long</span>    ticks;
00142 <span class="comment">/*1b0*/</span> <span class="keywordtype">char</span>    nameLen;
00143 <span class="comment">/*1b1*/</span> <span class="keywordtype">char</span>    fileName[MAXNAMELEN+1];
00144         <span class="keywordtype">long</span>    r4;
00145 <span class="comment">/*1d4*/</span> <span class="keywordtype">long</span>    real;       <span class="comment">/* unused == 0 */</span>
00146 <span class="comment">/*1d8*/</span> <span class="keywordtype">long</span>    nextLink;   <span class="comment">/* link chain */</span>
00147         <span class="keywordtype">long</span>    r5[5];
00148 <span class="comment">/*1f0*/</span> <span class="keywordtype">long</span>    nextSameHash;   <span class="comment">/* next entry with sane hash */</span>
00149 <span class="comment">/*1f4*/</span> <span class="keywordtype">long</span>    parent;     <span class="comment">/* parent directory */</span>
00150 <span class="comment">/*1f8*/</span> <span class="keywordtype">long</span>    extension;  <span class="comment">/* pointer to extension block */</span>
00151 <span class="comment">/*1fc*/</span> <span class="keywordtype">long</span>    secType;    <span class="comment">/* == -3 */</span>
00152 };
00153 
00154 
00155 <span class="comment">/*--- file header extension block structure ---*/</span>
00156 
00157 <span class="keyword">struct </span>bFileExtBlock {
00158 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;       <span class="comment">/* == 0x10 */</span>
00159 <span class="comment">/*004*/</span> <span class="keywordtype">long</span>    headerKey;
00160 <span class="comment">/*008*/</span> <span class="keywordtype">long</span>    highSeq;
00161 <span class="comment">/*00c*/</span> <span class="keywordtype">long</span>    dataSize;   <span class="comment">/* == 0 */</span>
00162 <span class="comment">/*010*/</span> <span class="keywordtype">long</span>    firstData;  <span class="comment">/* == 0 */</span>
00163 <span class="comment">/*014*/</span> ULONG   checkSum;
00164 <span class="comment">/*018*/</span> <span class="keywordtype">long</span>    dataBlocks[MAX_DATABLK];
00165         <span class="keywordtype">long</span>    r[45];
00166         <span class="keywordtype">long</span>    info;       <span class="comment">/* == 0 */</span>
00167         <span class="keywordtype">long</span>    nextSameHash;   <span class="comment">/* == 0 */</span>
00168 <span class="comment">/*1f4*/</span> <span class="keywordtype">long</span>    parent;     <span class="comment">/* header block */</span>
00169 <span class="comment">/*1f8*/</span> <span class="keywordtype">long</span>    extension;  <span class="comment">/* next header extension block */</span>
00170 <span class="comment">/*1fc*/</span> <span class="keywordtype">long</span>    secType;    <span class="comment">/* -3 */</span>    
00171 };
00172 
00173 
00174 
00175 <span class="keyword">struct </span>bDirBlock {
00176 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;       <span class="comment">/* == 2 */</span>
00177 <span class="comment">/*004*/</span> <span class="keywordtype">long</span>    headerKey;
00178 <span class="comment">/*008*/</span> <span class="keywordtype">long</span>    highSeq;    <span class="comment">/* == 0 */</span>
00179 <span class="comment">/*00c*/</span> <span class="keywordtype">long</span>    hashTableSize;  <span class="comment">/* == 0 */</span>
00180         <span class="keywordtype">long</span>    r1;     <span class="comment">/* == 0 */</span>
00181 <span class="comment">/*014*/</span> ULONG   checkSum;
00182 <span class="comment">/*018*/</span> <span class="keywordtype">long</span>    hashTable[HT_SIZE];     <span class="comment">/* hash table */</span>
00183         <span class="keywordtype">long</span>    r2[2];
00184 <span class="comment">/*140*/</span> <span class="keywordtype">long</span>    access;
00185         <span class="keywordtype">long</span>    r4;     <span class="comment">/* == 0 */</span>
00186 <span class="comment">/*148*/</span> <span class="keywordtype">char</span>    commLen;
00187 <span class="comment">/*149*/</span> <span class="keywordtype">char</span>    comment[MAXCMMTLEN+1];
00188         <span class="keywordtype">char</span>    r5[91-(MAXCMMTLEN+1)];
00189 <span class="comment">/*1a4*/</span> <span class="keywordtype">long</span>    days;       <span class="comment">/* last access */</span>
00190 <span class="comment">/*1a8*/</span> <span class="keywordtype">long</span>    mins;
00191 <span class="comment">/*1ac*/</span> <span class="keywordtype">long</span>    ticks;
00192 <span class="comment">/*1b0*/</span> <span class="keywordtype">char</span>    nameLen;
00193 <span class="comment">/*1b1*/</span> <span class="keywordtype">char</span>    dirName[MAXNAMELEN+1];
00194         <span class="keywordtype">long</span>    r6;
00195 <span class="comment">/*1d4*/</span> <span class="keywordtype">long</span>    real;       <span class="comment">/* ==0 */</span>
00196 <span class="comment">/*1d8*/</span> <span class="keywordtype">long</span>    nextLink;   <span class="comment">/* link list */</span>
00197         <span class="keywordtype">long</span>    r7[5];
00198 <span class="comment">/*1f0*/</span> <span class="keywordtype">long</span>    nextSameHash;
00199 <span class="comment">/*1f4*/</span> <span class="keywordtype">long</span>    parent;
00200 <span class="comment">/*1f8*/</span> <span class="keywordtype">long</span>    extension;      <span class="comment">/* FFS : first directory cache */</span>
00201 <span class="comment">/*1fc*/</span> <span class="keywordtype">long</span>    secType;    <span class="comment">/* == 2 */</span>
00202 };
00203 
00204 
00205 
00206 <span class="keyword">struct </span>bOFSDataBlock{
00207 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;       <span class="comment">/* == 8 */</span>
00208 <span class="comment">/*004*/</span> <span class="keywordtype">long</span>    headerKey;  <span class="comment">/* pointer to file_hdr block */</span>
00209 <span class="comment">/*008*/</span> <span class="keywordtype">long</span>    seqNum; <span class="comment">/* file data block number */</span>
00210 <span class="comment">/*00c*/</span> <span class="keywordtype">long</span>    dataSize;   <span class="comment">/* &lt;= 0x1e8 */</span>
00211 <span class="comment">/*010*/</span> <span class="keywordtype">long</span>    nextData;   <span class="comment">/* next data block */</span>
00212 <span class="comment">/*014*/</span> ULONG   checkSum;
00213 <span class="comment">/*018*/</span> UCHAR   data[488];
00214 <span class="comment">/*200*/</span> };
00215 
00216 
00217 <span class="comment">/* --- bitmap --- */</span>
00218 
00219 <span class="keyword">struct </span>bBitmapBlock {
00220 <span class="comment">/*000*/</span> ULONG   checkSum;
00221 <span class="comment">/*004*/</span> ULONG   map[127];
00222     };
00223 
00224 
00225 <span class="keyword">struct </span>bBitmapExtBlock {
00226 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    bmPages[127];
00227 <span class="comment">/*1fc*/</span> <span class="keywordtype">long</span>    nextBlock;
00228     };
00229 
00230 
00231 <span class="keyword">struct </span>bLinkBlock {
00232 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;       <span class="comment">/* == 2 */</span>
00233 <span class="comment">/*004*/</span> <span class="keywordtype">long</span>    headerKey;  <span class="comment">/* self pointer */</span>
00234         <span class="keywordtype">long</span>    r1[3];
00235 <span class="comment">/*014*/</span> ULONG   checkSum;
00236 <span class="comment">/*018*/</span> <span class="keywordtype">char</span>    realName[64];
00237         <span class="keywordtype">long</span>    r2[83];
00238 <span class="comment">/*1a4*/</span> <span class="keywordtype">long</span>    days;       <span class="comment">/* last access */</span>
00239 <span class="comment">/*1a8*/</span> <span class="keywordtype">long</span>    mins;
00240 <span class="comment">/*1ac*/</span> <span class="keywordtype">long</span>    ticks;
00241 <span class="comment">/*1b0*/</span> <span class="keywordtype">char</span>    nameLen;
00242 <span class="comment">/*1b1*/</span> <span class="keywordtype">char</span>    name[MAXNAMELEN+1];
00243         <span class="keywordtype">long</span>    r3;
00244 <span class="comment">/*1d4*/</span> <span class="keywordtype">long</span>    realEntry;
00245 <span class="comment">/*1d8*/</span> <span class="keywordtype">long</span>    nextLink;
00246         <span class="keywordtype">long</span>    r4[5];
00247 <span class="comment">/*1f0*/</span> <span class="keywordtype">long</span>    nextSameHash;
00248 <span class="comment">/*1f4*/</span> <span class="keywordtype">long</span>    parent; 
00249         <span class="keywordtype">long</span>    r5;
00250 <span class="comment">/*1fc*/</span> <span class="keywordtype">long</span>    secType;    <span class="comment">/* == -4, 4, 3 */</span>
00251     };
00252 
00253 
00254 
00255 <span class="comment">/*--- directory cache block structure ---*/</span>
00256 
00257 <span class="keyword">struct </span>bDirCacheBlock {
00258 <span class="comment">/*000*/</span> <span class="keywordtype">long</span>    type;       <span class="comment">/* == 33 */</span>
00259 <span class="comment">/*004*/</span> <span class="keywordtype">long</span>    headerKey;
00260 <span class="comment">/*008*/</span> <span class="keywordtype">long</span>    parent;
00261 <span class="comment">/*00c*/</span> <span class="keywordtype">long</span>    recordsNb;
00262 <span class="comment">/*010*/</span> <span class="keywordtype">long</span>    nextDirC;
00263 <span class="comment">/*014*/</span> ULONG   checkSum;
00264 <span class="comment">/*018*/</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> records[488];
00265     };
00266 
00267 
00268 <span class="preprocessor">#endif </span><span class="comment">/* ADF_BLK_H */</span>
00269 <span class="comment">/*##########################################################################*/</span>
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:37 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
