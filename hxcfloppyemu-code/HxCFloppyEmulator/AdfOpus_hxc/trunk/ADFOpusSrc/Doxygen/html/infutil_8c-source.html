<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>infutil.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>infutil.c</h1><div class="fragment"><pre>00001 <span class="comment">/* inflate_util.c -- data and routines common to blocks and codes</span>
00002 <span class="comment"> * Copyright (C) 1995-2002 Mark Adler</span>
00003 <span class="comment"> * For conditions of distribution and use, see copyright notice in zlib.h </span>
00004 <span class="comment"> */</span>
00005 
00006 <span class="preprocessor">#include "zutil.h"</span>
00007 <span class="preprocessor">#include "infblock.h"</span>
00008 <span class="preprocessor">#include "inftrees.h"</span>
00009 <span class="preprocessor">#include "infcodes.h"</span>
00010 <span class="preprocessor">#include "infutil.h"</span>
00011 
00012 <span class="keyword">struct </span>inflate_codes_state {<span class="keywordtype">int</span> dummy;}; <span class="comment">/* for buggy compilers */</span>
00013 
00014 <span class="comment">/* And'ing with mask[n] masks the lower n bits */</span>
00015 uInt inflate_mask[17] = {
00016     0x0000,
00017     0x0001, 0x0003, 0x0007, 0x000f, 0x001f, 0x003f, 0x007f, 0x00ff,
00018     0x01ff, 0x03ff, 0x07ff, 0x0fff, 0x1fff, 0x3fff, 0x7fff, 0xffff
00019 };
00020 
00021 
00022 <span class="comment">/* copy as much as possible from the sliding window to the output area */</span>
00023 <span class="keywordtype">int</span> inflate_flush(s, z, r)
00024 inflate_blocks_statef *s;
00025 z_streamp z;
00026 <span class="keywordtype">int</span> r;
00027 {
00028   uInt n;
00029   Bytef *p;
00030   Bytef *q;
00031 
00032   <span class="comment">/* local copies of source and destination pointers */</span>
00033   p = z-&gt;next_out;
00034   q = s-&gt;read;
00035 
00036   <span class="comment">/* compute number of bytes to copy as far as end of window */</span>
00037   n = (uInt)((q &lt;= s-&gt;write ? s-&gt;write : s-&gt;end) - q);
00038   <span class="keywordflow">if</span> (n &gt; z-&gt;avail_out) n = z-&gt;avail_out;
00039   <span class="keywordflow">if</span> (n &amp;&amp; r == Z_BUF_ERROR) r = Z_OK;
00040 
00041   <span class="comment">/* update counters */</span>
00042   z-&gt;avail_out -= n;
00043   z-&gt;total_out += n;
00044 
00045   <span class="comment">/* update check information */</span>
00046   <span class="keywordflow">if</span> (s-&gt;checkfn != Z_NULL)
00047     z-&gt;adler = s-&gt;check = (*s-&gt;checkfn)(s-&gt;check, q, n);
00048 
00049   <span class="comment">/* copy as far as end of window */</span>
00050   zmemcpy(p, q, n);
00051   p += n;
00052   q += n;
00053 
00054   <span class="comment">/* see if more to copy at beginning of window */</span>
00055   <span class="keywordflow">if</span> (q == s-&gt;end)
00056   {
00057     <span class="comment">/* wrap pointers */</span>
00058     q = s-&gt;window;
00059     <span class="keywordflow">if</span> (s-&gt;write == s-&gt;end)
00060       s-&gt;write = s-&gt;window;
00061 
00062     <span class="comment">/* compute bytes to copy */</span>
00063     n = (uInt)(s-&gt;write - q);
00064     <span class="keywordflow">if</span> (n &gt; z-&gt;avail_out) n = z-&gt;avail_out;
00065     <span class="keywordflow">if</span> (n &amp;&amp; r == Z_BUF_ERROR) r = Z_OK;
00066 
00067     <span class="comment">/* update counters */</span>
00068     z-&gt;avail_out -= n;
00069     z-&gt;total_out += n;
00070 
00071     <span class="comment">/* update check information */</span>
00072     <span class="keywordflow">if</span> (s-&gt;checkfn != Z_NULL)
00073       z-&gt;adler = s-&gt;check = (*s-&gt;checkfn)(s-&gt;check, q, n);
00074 
00075     <span class="comment">/* copy */</span>
00076     zmemcpy(p, q, n);
00077     p += n;
00078     q += n;
00079   }
00080 
00081   <span class="comment">/* update pointers */</span>
00082   z-&gt;next_out = p;
00083   s-&gt;read = q;
00084 
00085   <span class="comment">/* done */</span>
00086   <span class="keywordflow">return</span> r;
00087 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:42 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
