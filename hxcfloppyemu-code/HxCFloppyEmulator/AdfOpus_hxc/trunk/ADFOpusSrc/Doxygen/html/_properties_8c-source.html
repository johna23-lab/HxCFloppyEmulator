<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Properties.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>Properties.c</h1><a href="_properties_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ADF Opus Copyright 1998-2002 by </span>
00002 <span class="comment"> * Dan Sutherland &lt;dan@chromerhino.demon.co.uk&gt; and Gary Harris &lt;gharris@zip.com.au&gt;.   </span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * This code by Gary Harris.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> */</span>
00013 <span class="comment">// Code and output for setting access flags with ADFLib.</span>
00014 <span class="comment">//</span>
00015 <span class="comment">// RETCODE adfSetEntryAccess(struct Volume* vol, SECTNUM parSect, char* name, long newAcc)</span>
00016 <span class="comment">//  </span>
00017 <span class="comment">//  CODE</span>
00018 <span class="comment">//  -----</span>
00019 <span class="comment">//  adfSetEntryAccess(vol, vol-&gt;curDirPtr, "dir_5u", 0|ACCMASK_A|ACCMASK_E);</span>
00020 <span class="comment">//  adfSetEntryAccess(vol, vol-&gt;curDirPtr, "file_1a", 0|ACCMASK_P|ACCMASK_W);</span>
00021 <span class="comment">//</span>
00022 <span class="comment">//  adfSetEntryAccess(vol, vol-&gt;curDirPtr, "dir_5u", 0x12 &amp; !ACCMASK_A &amp; !ACCMASK_E);</span>
00023 <span class="comment">//  adfSetEntryAccess(vol, vol-&gt;curDirPtr, "file_1a", 0x24 &amp; !ACCMASK_P &amp; !ACCMASK_W );</span>
00024 <span class="comment">//</span>
00025 <span class="comment">//  OUTPUT</span>
00026 <span class="comment">//  ------</span>
00027 <span class="comment">//  (Default flags)</span>
00028 <span class="comment">//  dir_5u                          2    885 30/11/2000 18:25:43         ----rwed</span>
00029 <span class="comment">//  file_1a                        -3    883 30/11/2000 18:25:43       1 ----rwed</span>
00030 <span class="comment">//</span>
00031 <span class="comment">//  (After first lines of code)</span>
00032 <span class="comment">//  dir_5u                          2    885 30/11/2000 18:25:43         ---arw-d</span>
00033 <span class="comment">//  file_1a                        -3    883 30/11/2000 18:25:43       1 --p-r-ed</span>
00034 <span class="comment">//</span>
00035 <span class="comment">//  (After second lines of code)</span>
00036 <span class="comment">//  dir_5u                          2    885 30/11/2000 18:25:43         ----rwed</span>
00037 <span class="comment">//  file_1a                        -3    883 30/11/2000 18:25:43       1 ----rwed</span>
00038 
00039 <span class="comment">// Default flags are ----rwed : HSPA are OFF when bit = 0, RWED are ON when bit = 0 !!!!!!</span>
00040 <span class="comment">// Therefore 00000000 = ----rwed</span>
00041 
00042 <span class="comment">// I should just have to create a bit mask and let the lib deal with this.</span>
00043 <span class="comment">// The mask has 1 where a bit is to be flipped. That is:</span>
00044 <span class="comment">// 10000001 changes the flags to H---RWE-</span>
00045 <span class="comment">// H and D are flipped. Do this with 0|ACCMASK_H|ACCMASK_D (F&amp;!0ACCMASK_H&amp;!ACCMASK_D).</span>
00046 
00047 
00048 <span class="preprocessor">#include "Properties.h"</span>
00049 <span class="preprocessor">#include "Install.h"</span>
00050 
00051 
00052 <span class="keyword">extern</span> HWND ghwndFrame;
00053 <span class="keyword">extern</span> HWND ghwndMDIClient;
00054 <span class="keyword">extern</span> HWND ghwndTB;
00055 
00056 LRESULT CALLBACK PropertiesProcWin(HWND dlg, UINT msg, WPARAM wp, LPARAM lp)
00057 <span class="comment">// Uses ci and bufdeclared in ChildCommon.h. </span>
00058 {
00059     <span class="keyword">static</span> DWORD aIds[] = { 
00060         IDC_PROPERTIES_FILENAME_WIN,    IDH_PROPERTIES_FILENAME_WIN,
00061         IDC_WIN_READONLY,               IDH_PROPERTIES_WIN_READONLY,    
00062         IDC_WIN_ARCHIVE,                IDH_PROPERTIES_WIN_ARCHIVE, 
00063         IDC_WIN_HIDDEN,                 IDH_PROPERTIES_WIN_HIDDEN,
00064         IDC_WIN_SYSTEM,                 IDH_PROPERTIES_WIN_SYSTEM,
00065         IDC_PROPERTIES_WIN_OK_BUTTON,   IDH_PROPERTIES_WIN_OK_BUTTON,
00066         IDC_PROPERTIES_WIN_HELP_BUTTON, IDH_PROPERTIES_WIN_HELP_BUTTON,
00067         IDCANCEL,                       IDH_PROPERTIES_WIN_CANCEL_BUTTON,
00068         0,0 
00069     };  
00070 
00071     
00072     DIRENTRY    *DirPtr = ci-&gt;content;
00073     HMENU       hMenu;
00074 
00075     <span class="keywordflow">switch</span>(msg) {
00076     <span class="keywordflow">case</span> WM_INITDIALOG:
00077         DirPtr = FindCIData(dlg, DirPtr);
00078         <span class="comment">// Write the file name to the static text box.</span>
00079         SetDlgItemText(dlg, IDC_PROPERTIES_FILENAME_WIN, DirPtr-&gt;name);
00080         
00081         <span class="comment">// Fill the appropriate checkboxes.</span>
00082         GetPropertiesWin(dlg, DirPtr);
00083         <span class="keywordflow">return</span> TRUE;
00084 
00085     <span class="keywordflow">case</span> WM_COMMAND:
00086         <span class="keywordflow">switch</span>((int)LOWORD(wp)) {
00087         <span class="keywordflow">case</span> IDC_PROPERTIES_WIN_OK_BUTTON:
00088                 <span class="comment">// Process flag changes.</span>
00089                 DirPtr = FindCIData(dlg, DirPtr);   
00090                 SetPropertiesWin(dlg, DirPtr);
00091 
00092             <span class="keywordflow">case</span> IDCANCEL:
00093                 <span class="comment">// Disable properties menu item and toolbar button.</span>
00094                 hMenu = GetMenu(ghwndFrame);
00095                 EnableMenuItem(hMenu, ID_ACTION_PROPERTIES, MF_GRAYED);
00096                 SendMessage(ghwndTB, TB_ENABLEBUTTON, ID_ACTION_PROPERTIES, MAKELONG(FALSE, 0));
00097                 EndDialog(dlg, TRUE);
00098                 <span class="keywordflow">return</span> TRUE;
00099 
00100             <span class="keywordflow">case</span> IDC_PROPERTIES_WIN_HELP_BUTTON:
00101                 <span class="comment">// Implement help button.</span>
00102                 WinHelp(dlg, <span class="stringliteral">"ADFOpus.hlp&gt;Opus_win"</span>, HELP_CONTEXT, IDH_PROPERTIES);
00103                 <span class="keywordflow">return</span> TRUE;
00104 
00105         }
00106         <span class="keywordflow">break</span>;
00107     <span class="keywordflow">case</span> WM_CLOSE:
00108         
00109         EndDialog(dlg, TRUE);
00110         <span class="keywordflow">return</span> TRUE;
00111 
00112     <span class="comment">// Context sensitive help.</span>
00113     <span class="keywordflow">case</span> WM_HELP: 
00114         WinHelp(((LPHELPINFO) lp)-&gt;hItemHandle, <span class="stringliteral">"adfopus.hlp"</span>, 
00115             HELP_WM_HELP, (DWORD) (LPSTR) aIds); 
00116         <span class="keywordflow">break</span>; 
00117  
00118     <span class="keywordflow">case</span> WM_CONTEXTMENU: 
00119         WinHelp((HWND) wp, <span class="stringliteral">"adfopus.hlp"</span>, HELP_CONTEXTMENU, (DWORD) (LPVOID) aIds); 
00120         <span class="keywordflow">break</span>;  
00121 
00122     }
00123     <span class="keywordflow">return</span> FALSE;
00124 }
00125 
00126 
00127 LRESULT CALLBACK PropertiesProcAmi(HWND dlg, UINT msg, WPARAM wp, LPARAM lp)
00128 <span class="comment">// Uses ci and buf declared in ChildCommon.h. </span>
00129 {
00130     <span class="keyword">static</span> DWORD aIds[] = {
00131         IDC_PROPERTIES_FILENAME_AMI,    IDH_PROPERTIES_FILENAME_AMI,
00132         IDC_AMI_READABLE,               IDH_PROPERTIES_AMI_READABLE,
00133         IDC_AMI_WRITABLE,               IDH_PROPERTIES_AMI_WRITABLE,
00134         IDC_AMI_EXECUTABLE,             IDH_PROPERTIES_AMI_EXECUTABLE,
00135         IDC_AMI_DELETABLE,              IDH_PROPERTIES_AMI_DELETABLE,
00136         IDC_AMI_SCRIPT,                 IDH_PROPERTIES_AMI_SCRIPT,
00137         IDC_AMI_ARCHIVE,                IDH_PROPERTIES_AMI_ARCHIVE,
00138         IDC_AMI_PURE,                   IDH_PROPERTIES_AMI_PURE,
00139         IDC_AMI_HOLDBIT,                IDH_PROPERTIES_AMI_HOLDBIT,
00140         IDC_EDIT_COMMENT,               IDH_PROPERTIES_AMI_COMMENT,
00141         IDC_PROPERTIES_AMI_OK_BUTTON,   IDH_PROPERTIES_AMI_OK_BUTTON,
00142         IDC_PROPERTIES_AMI_HELP_BUTTON, IDH_PROPERTIES_AMI_HELP_BUTTON,
00143         IDCANCEL,                       IDH_PROPERTIES_AMI_CANCEL_BUTTON,
00144         0,0 
00145     };  
00146 
00147     
00148     DIRENTRY    *DirPtr = ci-&gt;content;
00149     HMENU       hMenu;
00150 
00151         <span class="keywordflow">switch</span>(msg) {
00152     <span class="keywordflow">case</span> WM_INITDIALOG:
00153         DirPtr = FindCIData(dlg, DirPtr);
00154         <span class="comment">// Write the file name to the static text box.</span>
00155         SetDlgItemText(dlg, IDC_PROPERTIES_FILENAME_AMI, DirPtr-&gt;name);
00156         
00157         <span class="comment">// Fill the appropriate checkboxes.</span>
00158         GetPropertiesAmi(dlg, DirPtr);
00159 
00160         <span class="keywordflow">return</span> TRUE;
00161 
00162     <span class="keywordflow">case</span> WM_COMMAND:
00163         <span class="keywordflow">switch</span>((int)LOWORD(wp)) {
00164         <span class="keywordflow">case</span> IDC_PROPERTIES_AMI_OK_BUTTON:
00165                 <span class="comment">// Process flag changes.</span>
00166                 DirPtr = FindCIData(dlg, DirPtr);   
00167                 SetPropertiesAmi(dlg, DirPtr);
00168 
00169             <span class="keywordflow">case</span> IDCANCEL:
00170                 <span class="comment">// Disable properties menu item and toolbar button.</span>
00171                 hMenu = GetMenu(ghwndFrame);
00172                 EnableMenuItem(hMenu, ID_ACTION_PROPERTIES, MF_GRAYED);
00173                 SendMessage(ghwndTB, TB_ENABLEBUTTON, ID_ACTION_PROPERTIES, MAKELONG(FALSE, 0));
00174                 EndDialog(dlg, TRUE);
00175                 <span class="keywordflow">return</span> TRUE;
00176 
00177             <span class="keywordflow">case</span> IDC_PROPERTIES_AMI_HELP_BUTTON:
00178                 <span class="comment">// Implement help button.</span>
00179                 WinHelp(dlg, <span class="stringliteral">"ADFOpus.hlp&gt;Opus_win"</span>, HELP_CONTEXT, IDH_PROPERTIES);
00180                 <span class="keywordflow">return</span> TRUE;
00181 
00182         }
00183         <span class="keywordflow">break</span>;
00184     <span class="keywordflow">case</span> WM_CLOSE:
00185         
00186         EndDialog(dlg, TRUE);
00187         <span class="keywordflow">return</span> TRUE;
00188 
00189     <span class="comment">// Context sensitive help.</span>
00190     <span class="keywordflow">case</span> WM_HELP: 
00191         WinHelp(((LPHELPINFO) lp)-&gt;hItemHandle, <span class="stringliteral">"adfopus.hlp"</span>, 
00192             HELP_WM_HELP, (DWORD) (LPSTR) aIds); 
00193         <span class="keywordflow">break</span>; 
00194  
00195     <span class="keywordflow">case</span> WM_CONTEXTMENU: 
00196         WinHelp((HWND) wp, <span class="stringliteral">"adfopus.hlp"</span>, HELP_CONTEXTMENU, (DWORD) (LPVOID) aIds); 
00197         <span class="keywordflow">break</span>;  
00198 
00199     }
00200     <span class="keywordflow">return</span> FALSE;
00201 }
00202 
00203 
00204 <span class="keywordtype">void</span> GetPropertiesAmi(HWND dlg, DIRENTRY *DirPtr)
00205 <span class="comment">// Get flags from directory entry and set appropriate boxes.</span>
00206 <span class="comment">// Properties in ADFLib are HSPARWED.</span>
00207 {
00208     <span class="keyword">struct </span>File *amiFile;
00209     <span class="keywordtype">int</span> i = 0;
00210 
00211     <span class="keywordflow">while</span>(DirPtr-&gt;flags[i] != <span class="charliteral">'\0'</span>){
00212         <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'R'</span>)
00213             SendDlgItemMessage(dlg, IDC_AMI_READABLE, BM_SETCHECK, BST_CHECKED, 0l);
00214         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'W'</span>)
00215             SendDlgItemMessage(dlg, IDC_AMI_WRITABLE, BM_SETCHECK, BST_CHECKED, 0l);
00216         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'E'</span>)
00217             SendDlgItemMessage(dlg, IDC_AMI_EXECUTABLE, BM_SETCHECK, BST_CHECKED, 0l);
00218         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'D'</span>)
00219             SendDlgItemMessage(dlg, IDC_AMI_DELETABLE, BM_SETCHECK, BST_CHECKED, 0l);
00220         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'S'</span>)
00221             SendDlgItemMessage(dlg, IDC_AMI_SCRIPT, BM_SETCHECK, BST_CHECKED, 0l);
00222         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'A'</span>)
00223             SendDlgItemMessage(dlg, IDC_AMI_ARCHIVE, BM_SETCHECK, BST_CHECKED, 0l);
00224         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'P'</span>)
00225             SendDlgItemMessage(dlg, IDC_AMI_PURE, BM_SETCHECK, BST_CHECKED, 0l);
00226         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'H'</span>)
00227             SendDlgItemMessage(dlg, IDC_AMI_HOLDBIT, BM_SETCHECK, BST_CHECKED, 0l);
00228         i++;
00229     }
00230 
00231 
00232     amiFile = adfOpenFile(ci-&gt;vol, DirPtr-&gt;name, <span class="stringliteral">"r"</span>);
00233     SendDlgItemMessage(dlg, IDC_EDIT_COMMENT, WM_SETTEXT, 0, (LPARAM)amiFile-&gt;fileHdr-&gt;comment);
00234     adfCloseFile(amiFile);
00235 
00236 }
00237 
00238 <span class="keywordtype">void</span> GetPropertiesWin(HWND dlg, DIRENTRY *DirPtr)
00239 <span class="comment">// Get flags from directory entry and set appropriate boxes.</span>
00240 {
00241     <span class="keywordtype">int</span> i = 0;
00242 
00243     <span class="keywordflow">while</span>(DirPtr-&gt;flags[i] != <span class="charliteral">'\0'</span>){
00244         <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'R'</span>)
00245             SendDlgItemMessage(dlg, IDC_WIN_READONLY, BM_SETCHECK, BST_CHECKED, 0l);
00246         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'A'</span>)
00247             SendDlgItemMessage(dlg, IDC_WIN_ARCHIVE, BM_SETCHECK, BST_CHECKED, 0l);
00248         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'H'</span>)
00249             SendDlgItemMessage(dlg, IDC_WIN_HIDDEN, BM_SETCHECK, BST_CHECKED, 0l);
00250         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DirPtr-&gt;flags[i] == <span class="charliteral">'S'</span>)
00251             SendDlgItemMessage(dlg, IDC_WIN_SYSTEM, BM_SETCHECK, BST_CHECKED, 0l);
00252         i++;
00253     }
00254 }
00255 
00256 
00257 <span class="keywordtype">void</span> SetPropertiesAmi(HWND dlg, DIRENTRY *DirPtr)
00258 <span class="comment">// Get flags from checkboxes and set appropriate directory entry flags.</span>
00259 <span class="comment">// Properties in ADFLib are HSPARWED. </span>
00260 <span class="comment">// Flags are 00000000 for ----RWED. 0 is off for first 4 and on for next 4.</span>
00261 <span class="comment">// File property flags. See ADFLib/adf_blk.h</span>
00262 {
00263 
00264     <span class="keywordtype">long</span>    longPropertyFlags = 15; <span class="comment">// Default flags 00001111 - all OFF!</span>
00265     <span class="keywordtype">char</span>    new_flags[9];
00266     <span class="keywordtype">char</span>    szComment[MAXCMMTLEN + 1];          <span class="comment">// Max comment length (79) defined in adf_blk.h + '\0'.</span>
00267     <span class="keywordtype">int</span>     i = 0;
00268     <span class="keywordtype">int</span>     iNumChars;
00269     HWND    win;
00270 
00271     <span class="comment">// Read the flags and create flag string and long.</span>
00272     <span class="comment">// Set RWED bits to 0 if flag set.</span>
00273     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_READABLE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00274         longPropertyFlags &amp;= ~ACCMASK_R;
00275         new_flags[i] = <span class="charliteral">'R'</span>;
00276         i++;
00277     }
00278     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_WRITABLE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00279         longPropertyFlags &amp;= ~ACCMASK_W;    <span class="comment">// Current flags NAND flag mask.</span>
00280         new_flags[i] = <span class="charliteral">'W'</span>;
00281         i++;
00282     }
00283     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_EXECUTABLE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00284         longPropertyFlags &amp;= ~ACCMASK_E;
00285         new_flags[i] = <span class="charliteral">'E'</span>;
00286         i++;
00287     }
00288     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_DELETABLE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00289         longPropertyFlags &amp;= ~ACCMASK_D;
00290         new_flags[i] = <span class="charliteral">'D'</span>;
00291         i++;
00292     }
00293     <span class="comment">// Set RWED bits to 1 if flag set.</span>
00294     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_SCRIPT, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00295         longPropertyFlags |= ACCMASK_S;
00296         new_flags[i] = <span class="charliteral">'S'</span>;
00297         i++;
00298     }
00299     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_ARCHIVE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00300         longPropertyFlags |= ACCMASK_A;
00301         new_flags[i] = <span class="charliteral">'A'</span>;
00302         i++;
00303     }
00304     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_PURE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00305         longPropertyFlags |= ACCMASK_P;
00306         new_flags[i] = <span class="charliteral">'P'</span>;
00307         i++;
00308     }
00309     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_AMI_HOLDBIT, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00310         longPropertyFlags |= ACCMASK_H;
00311         new_flags[i] = <span class="charliteral">'H'</span>;
00312         i++;
00313     }
00314     new_flags[i] = <span class="charliteral">'\0'</span>;
00315     
00316     <span class="comment">// Update file properties.</span>
00317     adfSetEntryAccess(ci-&gt;vol, ci-&gt;vol-&gt;curDirPtr, DirPtr-&gt;name, longPropertyFlags);
00318 
00319     <span class="comment">// If file comment text has changed, update file comment.</span>
00320     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_EDIT_COMMENT, EM_GETMODIFY, 0, 0)){
00321         iNumChars = SendDlgItemMessage(dlg, IDC_EDIT_COMMENT, WM_GETTEXTLENGTH, 0, 0);
00322         SendDlgItemMessage(dlg, IDC_EDIT_COMMENT, EM_GETLINE, iNumChars + 1, (LPARAM)szComment);
00323         szComment[iNumChars]= <span class="charliteral">'\0'</span>;
00324         adfSetEntryComment(ci-&gt;vol, ci-&gt;vol-&gt;curDirPtr, DirPtr-&gt;name, szComment);
00325     }
00326 
00327     <span class="comment">// Update MDI window childinfo data and listview.   </span>
00328     win = GetParent(dlg);
00329     SendMessage(win, WM_COMMAND, ID_VIEW_REFRESH, 0l);
00330 <span class="comment">//  CheckForNDOS();</span>
00331 
00332 
00333 }
00334 
00335 
00336 
00337 <span class="keywordtype">void</span> SetPropertiesWin(HWND dlg, DIRENTRY *DirPtr)
00338 <span class="comment">// Get flags from checkboxes and set appropriate directory entry flags.</span>
00339 {
00340     <span class="keywordtype">char</span>    new_flags[5];
00341     <span class="keywordtype">int</span>     i = 0;
00342     <span class="keywordtype">char</span>    lpFileName[MAX_PATH];   <span class="comment">// Pointer to filename.</span>
00343     DWORD   dwFileAttributes = 0;   <span class="comment">// Attributes to set.</span>
00344     HWND    win;
00345 
00346 
00347     <span class="comment">// Read the flags and create flag string and attribute dword.</span>
00348     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_WIN_READONLY, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00349         new_flags[i] = <span class="charliteral">'R'</span>;
00350         dwFileAttributes |= FILE_ATTRIBUTE_READONLY;
00351         i++;
00352     }
00353     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_WIN_HIDDEN, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00354         new_flags[i] = <span class="charliteral">'H'</span>;
00355         dwFileAttributes |= FILE_ATTRIBUTE_HIDDEN;
00356         i++;
00357     }
00358     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_WIN_SYSTEM, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00359         dwFileAttributes |= FILE_ATTRIBUTE_SYSTEM;
00360         new_flags[i] = <span class="charliteral">'S'</span>;
00361         i++;
00362     }
00363     <span class="keywordflow">if</span>(SendDlgItemMessage(dlg, IDC_WIN_ARCHIVE, BM_GETCHECK, 0l, 0l) == BST_CHECKED){
00364         dwFileAttributes |= FILE_ATTRIBUTE_ARCHIVE;
00365         new_flags[i] = <span class="charliteral">'A'</span>;
00366         i++;
00367     }
00368     new_flags[i] = <span class="charliteral">'\0'</span>;
00369 
00370     <span class="comment">// Update file properties.</span>
00371     <span class="comment">// Create file path.</span>
00372     strcpy(lpFileName, ci-&gt;curDir);
00373     strcat(lpFileName, DirPtr-&gt;name);
00374     <span class="comment">// Change file attributes.</span>
00375     <span class="keywordflow">if</span>(!SetFileAttributes(lpFileName, dwFileAttributes))
00376         MessageBox(dlg, <span class="stringliteral">"Couldn't update file properties."</span>, <span class="stringliteral">"ADF Opus error"</span>, MB_OK);
00377     
00378     <span class="comment">// Update MDI window childinfo data and listview.   </span>
00379     win = GetParent(dlg);
00380     SendMessage(win, WM_COMMAND, ID_VIEW_REFRESH, 0l);
00381 }
00382 
00383 
00384 DIRENTRY *FindCIData(HWND dlg, DIRENTRY *DirPtr)
00385 <span class="comment">// Find the correct entry in the CHILDINFO struct.</span>
00386 <span class="comment">// The "content" member of CHILDINFO and all "next" sub-members are of type DIRENTRY.</span>
00387 <span class="comment">// This includes files. Both are defined in ChildCommon.h.</span>
00388 {
00389     <span class="keywordflow">while</span>(strcmp(DirPtr-&gt;name, buf) != 0){
00390         <span class="keywordflow">if</span>(DirPtr-&gt;next == NULL){
00391             MessageBox(dlg, <span class="stringliteral">"Couldn't find filename in CHILDINFO struct."</span>, 
00392                     <span class="stringliteral">"ADF Opus error"</span>, MB_OK);
00393             <span class="keywordflow">return</span>(NULL);
00394         }
00395         DirPtr = DirPtr-&gt;next;
00396     }
00397     <span class="keywordflow">return</span>(DirPtr);
00398 }
00399 
00400 <span class="comment">// STILL TO DO</span>
00401 <span class="comment">// - Investigate "TODO: RDSK autodetection" in adfopus/ChildCommon.c. --- NT4 etc.</span>
00402 
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:42 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
