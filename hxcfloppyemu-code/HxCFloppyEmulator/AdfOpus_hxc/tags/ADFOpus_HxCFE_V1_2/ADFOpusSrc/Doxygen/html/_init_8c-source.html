<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Init.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>Init.c</h1><a href="_init_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ADF Opus Copyright 1998-2002 by </span>
00002 <span class="comment"> * Dan Sutherland &lt;dan@chromerhino.demon.co.uk&gt; and Gary Harris &lt;gharris@zip.com.au&gt;.   </span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> */</span>
00011 <span class="preprocessor">#include "Pch.h"</span>
00012 
00013 <span class="preprocessor">#include "ADFOpus.h"</span>
00014 <span class="preprocessor">#include "ChildCommon.h"</span>
00015 <span class="preprocessor">#include "Init.h"</span>
00016 
00017 <span class="keyword">extern</span> HINSTANCE instance;
00018 
00019 <span class="comment">/* prototypes */</span>
00020 <span class="keywordtype">void</span> AddIcon(HIMAGELIST il, <span class="keywordtype">int</span> id);
00021 
00022 BOOL RegisterAppClass(HANDLE hInstance)
00023 <span class="comment">/* registers window classes */</span>
00024 {
00025     WNDCLASS wndClass;
00026 
00027     <span class="comment">/* attributes common to all windows */</span>
00028     wndClass.style = 0;
00029     wndClass.cbClsExtra = 0;
00030     wndClass.cbWndExtra = <span class="keyword">sizeof</span>(LONG);
00031     wndClass.hCursor = LoadCursor(NULL, IDC_ARROW);
00032     wndClass.hInstance = hInstance;
00033 
00034     <span class="comment">/* the application main window */</span>
00035     wndClass.lpfnWndProc = MainWinProc;
00036     wndClass.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_MAIN));
00037     wndClass.hbrBackground = (HBRUSH) (COLOR_BTNFACE + 1);
00038     wndClass.lpszMenuName = MAKEINTRESOURCE(IDR_MAINMENU);
00039     wndClass.lpszClassName = APPCLASSNAME;
00040 
00041     <span class="keywordflow">if</span>(! RegisterClass(&amp;wndClass))
00042         <span class="keywordflow">return</span> FALSE;
00043 
00044     <span class="comment">/* register the windows lister window */</span>
00045     wndClass.lpfnWndProc = ChildWinProc;
00046     wndClass.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_WINLISTER));
00047     wndClass.hbrBackground = (HBRUSH) (COLOR_BTNFACE + 1);
00048     wndClass.lpszMenuName = NULL;
00049     wndClass.lpszClassName = WINLISTERCLASSNAME;
00050 
00051     <span class="keywordflow">if</span>(! RegisterClass(&amp;wndClass))
00052     {
00053         UnregisterClass(APPCLASSNAME, hInstance);
00054         <span class="keywordflow">return</span> FALSE;
00055     }
00056 
00057     <span class="comment">/* register the amiga lister window */</span>
00058     wndClass.lpfnWndProc = ChildWinProc;
00059     wndClass.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_AMILISTER));
00060     wndClass.hbrBackground = (HBRUSH) (COLOR_BTNFACE + 1);
00061     wndClass.lpszMenuName = NULL;
00062     wndClass.lpszClassName = AMILISTERCLASSNAME;
00063 
00064     <span class="keywordflow">if</span>(! RegisterClass(&amp;wndClass))
00065     {
00066         UnregisterClass(WINLISTERCLASSNAME, hInstance);
00067         UnregisterClass(APPCLASSNAME, hInstance);
00068         <span class="keywordflow">return</span> FALSE;
00069     }
00070 
00071     <span class="keywordflow">return</span> TRUE;
00072 }
00073 
00074 <span class="keywordtype">void</span> UnregisterAllClasses(HANDLE hInstance)
00075 <span class="comment">/* unregisters all registered classes (part of the program cleanup) */</span>
00076 {
00077     UnregisterClass(AMILISTERCLASSNAME, hInstance);
00078     UnregisterClass(WINLISTERCLASSNAME, hInstance);
00079     UnregisterClass(APPCLASSNAME, hInstance);
00080 
00081     <span class="keywordflow">return</span>;
00082 }
00083 
00084 HWND CreateAppWindow(HANDLE hInstance)
00085 <span class="comment">/* creates the application main window */</span>
00086 {
00087     <span class="keywordtype">char</span> Title[64];
00088     LoadString(hInstance, IDS_VERSION, Title, <span class="keyword">sizeof</span>(Title));
00089 
00090     <span class="keywordflow">return</span>(CreateWindow(
00091         APPCLASSNAME,
00092         Title,
00093         WS_OVERLAPPEDWINDOW,
00094         CW_USEDEFAULT, 0,
00095         CW_USEDEFAULT, 0,
00096         NULL,
00097         NULL,
00098         hInstance,
00099         NULL
00100     ));
00101 }
00102 
00103 HWND CreateMDIClientWindow(HWND hwndFrame)
00104 <span class="comment">/* creates the client window that will handle the MDI child windows */</span>
00105 {
00106     HWND hwndClient;
00107     CLIENTCREATESTRUCT ccs;
00108 
00109     ccs.hWindowMenu = GetSubMenu(GetMenu(hwndFrame), 5);
00110 
00111     ccs.idFirstChild = IDM_WINDOWCHILD;
00112 
00113     hwndClient = CreateWindow(
00114         <span class="stringliteral">"MDICLIENT"</span>,
00115         NULL,
00116         WS_CHILD | WS_CLIPSIBLINGS,
00117         0, 100,
00118         1, 1,
00119         hwndFrame,
00120         NULL,
00121         instance,
00122         (LPVOID)&amp;ccs
00123     );
00124 
00125     ShowWindow(hwndClient, SW_SHOW);
00126 
00127     <span class="keywordflow">return</span>(hwndClient);
00128 }
00129 
00130 <span class="keywordtype">void</span> AddIcon(HIMAGELIST il, <span class="keywordtype">int</span> id)
00131 {
00132     HICON icon = LoadIcon(instance, MAKEINTRESOURCE(id));
00133     ImageList_AddIcon(il, icon);
00134     DeleteObject(icon);
00135 }
00136 
00137 HIMAGELIST CreateImageList()
00138 <span class="comment">/* creates an image list containing icons for the list-view control */</span>
00139 {
00140     HIMAGELIST il;
00141  
00142     <span class="comment">/* create the image list */</span>
00143     il = ImageList_Create(GetSystemMetrics(SM_CXSMICON), 
00144         GetSystemMetrics(SM_CYSMICON), ILC_COLOR16 | ILC_MASK, 11, 1);
00145 
00146     <span class="comment">/* add the icons */</span>
00147     AddIcon(il, IDI_WINFILE);
00148     AddIcon(il, IDI_WINDIR); 
00149     AddIcon(il, IDI_AMIFILE);
00150     AddIcon(il, IDI_AMIDIR);
00151     AddIcon(il, IDI_DRIVEHD);
00152     AddIcon(il, IDI_DRIVENET);
00153     AddIcon(il, IDI_DRIVECD);
00154     AddIcon(il, IDI_DRIVEFLOP35);
00155     AddIcon(il, IDI_DRIVEFLOP514);
00156 
00157     <span class="keywordflow">return</span> il;
00158 }
00159 
00160 HWND CreateToolBar(HWND hwndParent)
00161 {
00162     HWND hwndTB;
00163     TBADDBITMAP tbab;
00164     TBBUTTON tbb[23];
00165     COLORMAP cm;
00166     HANDLE hbm;
00167  
00168     hwndTB = CreateWindowEx(
00169         0,
00170         TOOLBARCLASSNAME,
00171         (LPSTR) NULL,
00172         WS_CHILD | TBSTYLE_TOOLTIPS | TBSTYLE_FLAT,
00173         0, 0,
00174         0, 0,
00175         hwndParent,
00176         (HMENU) ID_TOOLBAR,
00177         instance,
00178         NULL
00179     ); 
00180  
00181     <span class="comment">/* Send the TB_BUTTONSTRUCTSIZE message - this is required for</span>
00182 <span class="comment">           the toolbar control to work */</span>
00183     SendMessage(hwndTB, TB_BUTTONSTRUCTSIZE, (WPARAM) <span class="keyword">sizeof</span>(TBBUTTON), 0);
00184 
00185     <span class="comment">// Add the bitmap containing button images to the toolbar.</span>
00186     cm.from = 0x00FF00FF;
00187     cm.to = GetSysColor(COLOR_BTNFACE);
00188 
00189     hbm = CreateMappedBitmap(instance, IDB_TBBUTTONS, 0, &amp;cm, 1);
00190     tbab.hInst = NULL;
00191     tbab.nID = (UINT) hbm;
00192     SendMessage(hwndTB, TB_ADDBITMAP, (WPARAM) 16, (WPARAM) &amp;tbab);
00193  
00194     <span class="comment">// Fill the TBBUTTON array with button information, and add the</span>
00195     <span class="comment">// buttons to the toolbar.</span>
00196     tbb[0].iBitmap = 0; 
00197     tbb[0].idCommand = ID_FIL_NEW; 
00198     tbb[0].fsState = TBSTATE_ENABLED; 
00199     tbb[0].fsStyle = TBSTYLE_BUTTON; 
00200     tbb[0].dwData = 0; 
00201     tbb[0].iString = 0; 
00202  
00203     tbb[1].iBitmap = 1;
00204     tbb[1].idCommand = ID_FIL_OPEN; 
00205     tbb[1].fsState = TBSTATE_ENABLED; 
00206     tbb[1].fsStyle = TBSTYLE_BUTTON; 
00207     tbb[1].dwData = 0; 
00208     tbb[1].iString = 0; 
00209  
00210     tbb[2].iBitmap = 2;
00211     tbb[2].idCommand = ID_FIL_CLOSE;
00212     tbb[2].fsState = TBSTATE_ENABLED;
00213     tbb[2].fsStyle = TBSTYLE_BUTTON;
00214     tbb[2].dwData = 0;
00215     tbb[2].iString = 0;
00216 
00217     tbb[3].iBitmap = 0;
00218     tbb[3].idCommand = 0;
00219     tbb[3].fsState = 0;
00220     tbb[3].fsStyle = TBSTYLE_SEP;
00221     tbb[3].dwData = 0;
00222     tbb[3].iString = 0;
00223 
00224     tbb[4].iBitmap = 3;
00225     tbb[4].idCommand = ID_ACTION_RENAME;
00226     tbb[4].fsState = TBSTATE_ENABLED;
00227     tbb[4].fsStyle = TBSTYLE_BUTTON;
00228     tbb[4].dwData = 0;
00229     tbb[4].iString = 0;
00230 
00231     tbb[5].iBitmap = 4;
00232     tbb[5].idCommand = ID_ACTION_DELETE;
00233     tbb[5].fsState = TBSTATE_ENABLED;
00234     tbb[5].fsStyle = TBSTYLE_BUTTON;
00235     tbb[5].dwData = 0;
00236     tbb[5].iString = 0;
00237 
00238     tbb[6].iBitmap = 5;
00239     tbb[6].idCommand = ID_ACTION_NEWDIRECTORY;
00240     tbb[6].fsState = TBSTATE_ENABLED;
00241     tbb[6].fsStyle = TBSTYLE_BUTTON;
00242     tbb[6].dwData = 0;
00243     tbb[6].iString = 0;
00244 
00245     tbb[7].iBitmap = 6;
00246     tbb[7].idCommand = ID_ACTION_UPONELEVEL;
00247     tbb[7].fsState = TBSTATE_ENABLED;
00248     tbb[7].fsStyle = TBSTYLE_BUTTON;
00249     tbb[7].dwData = 0;
00250     tbb[7].iString = 0;
00251 
00252     tbb[8].iBitmap = 0;
00253     tbb[8].idCommand = 0;
00254     tbb[8].fsState = 0;
00255     tbb[8].fsStyle = TBSTYLE_SEP;
00256     tbb[8].dwData = 0;
00257     tbb[8].iString = 0;
00258 
00259     tbb[9].iBitmap = 7;
00260     tbb[9].idCommand = ID_VIEW_SHOWUNDELETABLEFILES;
00261     tbb[9].fsState = TBSTATE_ENABLED;
00262     tbb[9].fsStyle = TBSTYLE_BUTTON;
00263     tbb[9].dwData = 0;
00264     tbb[9].iString = 0;
00265 
00266     tbb[10].iBitmap = 8;
00267     tbb[10].idCommand = ID_ACTION_UNDELETE;
00268     tbb[10].fsState = TBSTATE_ENABLED;
00269     tbb[10].fsStyle = TBSTYLE_BUTTON;
00270     tbb[10].dwData = 0;
00271     tbb[10].iString = 0;
00272 
00273     tbb[11].iBitmap = 0;
00274     tbb[11].idCommand = 0;
00275     tbb[11].fsState = 0;
00276     tbb[11].fsStyle = TBSTYLE_SEP;
00277     tbb[11].dwData = 0;
00278     tbb[11].iString = 0;
00279 
00280     tbb[12].iBitmap = 9;
00281     tbb[12].idCommand = ID_FIL_INFORMATION;
00282     tbb[12].fsState = TBSTATE_ENABLED;
00283     tbb[12].fsStyle = TBSTYLE_BUTTON;
00284     tbb[12].dwData = 0;
00285     tbb[12].iString = 0;
00286 
00287     tbb[13].iBitmap = 0;
00288     tbb[13].idCommand = 0;
00289     tbb[13].fsState = 0;
00290     tbb[13].fsStyle = TBSTYLE_SEP;
00291     tbb[13].dwData = 0;
00292     tbb[13].iString = 0;
00293 
00294     tbb[14].iBitmap = 10;
00295     tbb[14].idCommand = ID_ACTION_PROPERTIES;
00296     tbb[14].fsState = TBSTATE_ENABLED;
00297     tbb[14].fsStyle = TBSTYLE_BUTTON;
00298     tbb[14].dwData = 0;
00299     tbb[14].iString = 0;
00300 
00301     tbb[15].iBitmap = 0;
00302     tbb[15].idCommand = 0;
00303     tbb[15].fsState = 0;
00304     tbb[15].fsStyle = TBSTYLE_SEP;
00305     tbb[15].dwData = 0;
00306     tbb[15].iString = 0;
00307 
00308     tbb[16].iBitmap = 11;
00309     tbb[16].idCommand = ID_TOOLS_OPTIONS;
00310     tbb[16].fsState = TBSTATE_ENABLED;
00311     tbb[16].fsStyle = TBSTYLE_BUTTON;
00312     tbb[16].dwData = 0;
00313     tbb[16].iString = 0;
00314 
00315     tbb[17].iBitmap = 0;
00316     tbb[17].idCommand = 0;
00317     tbb[17].fsState = 0;
00318     tbb[17].fsStyle = TBSTYLE_SEP;
00319     tbb[17].dwData = 0;
00320     tbb[17].iString = 0;
00321 
00322     tbb[18].iBitmap = 12;
00323     tbb[18].idCommand = ID_TOOLS_BATCHCONVERTER;
00324     tbb[18].fsState = TBSTATE_ENABLED;
00325     tbb[18].fsStyle = TBSTYLE_BUTTON;
00326     tbb[18].dwData = 0;
00327     tbb[18].iString = 0;
00328     
00329     tbb[19].iBitmap = 13;
00330     tbb[19].idCommand = ID_TOOLS_DISK2FDI;
00331     tbb[19].fsState = TBSTATE_ENABLED;
00332     tbb[19].fsStyle = TBSTYLE_BUTTON;
00333     tbb[19].dwData = 0;
00334     tbb[19].iString = 0;
00335 
00336     tbb[20].iBitmap = 0;
00337     tbb[20].idCommand = 0;
00338     tbb[20].fsState = 0;
00339     tbb[20].fsStyle = TBSTYLE_SEP;
00340     tbb[20].dwData = 0;
00341     tbb[20].iString = 0;
00342 
00343     tbb[21].iBitmap = 14;
00344     tbb[21].idCommand = ID_TOOLS_INSTALL;
00345     tbb[21].fsState = TBSTATE_ENABLED;
00346     tbb[21].fsStyle = TBSTYLE_BUTTON;
00347     tbb[21].dwData = 0;
00348     tbb[21].iString = 0;
00349 
00350     tbb[22].iBitmap = 15;
00351     tbb[22].idCommand = ID_TOOLS_DISPLAYBOOTBLOCK;
00352     tbb[22].fsState = TBSTATE_ENABLED;
00353     tbb[22].fsStyle = TBSTYLE_BUTTON;
00354     tbb[22].dwData = 0;
00355     tbb[22].iString = 0;
00356     
00357     SendMessage(hwndTB, TB_ADDBUTTONS, (WPARAM) 23, (LPARAM) (LPTBBUTTON) &amp;tbb);
00358     SendMessage(hwndTB, TB_AUTOSIZE, 0, 0);
00359 
00360     ShowWindow(hwndTB, SW_SHOW);
00361     <span class="keywordflow">return</span> hwndTB;
00362 }
00363 
00364 HWND CreateStatusBar(HWND hwndParent)
00365 { 
00366     HWND hwndSB;
00367  
00368     hwndSB = CreateWindowEx(
00369         0,
00370         STATUSCLASSNAME,
00371         (LPCTSTR) NULL,
00372         SBARS_SIZEGRIP | WS_CHILD,
00373         0, 0, 0, 0,
00374         hwndParent,
00375         (HMENU) ID_STATUSBAR,
00376         instance,
00377         NULL
00378     );
00379 
00380     ShowWindow(hwndSB, SW_SHOW);
00381 
00382     <span class="keywordflow">return</span> hwndSB; 
00383 } 
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:42 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
