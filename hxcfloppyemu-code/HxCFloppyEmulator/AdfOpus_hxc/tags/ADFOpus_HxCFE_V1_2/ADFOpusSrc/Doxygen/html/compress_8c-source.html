<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>compress.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>compress.c</h1><div class="fragment"><pre>00001 <span class="comment">/* compress.c -- compress a memory buffer</span>
00002 <span class="comment"> * Copyright (C) 1995-2002 Jean-loup Gailly.</span>
00003 <span class="comment"> * For conditions of distribution and use, see copyright notice in zlib.h </span>
00004 <span class="comment"> */</span>
00005 
00006 <span class="comment">/* @(#) $Id: compress_8c-source.html,v 1.1 2002/11/14 01:50:01 garyjharris Exp $ */</span>
00007 
00008 <span class="preprocessor">#include "zlib.h"</span>
00009 
00010 <span class="comment">/* ===========================================================================</span>
00011 <span class="comment">     Compresses the source buffer into the destination buffer. The level</span>
00012 <span class="comment">   parameter has the same meaning as in deflateInit.  sourceLen is the byte</span>
00013 <span class="comment">   length of the source buffer. Upon entry, destLen is the total size of the</span>
00014 <span class="comment">   destination buffer, which must be at least 0.1% larger than sourceLen plus</span>
00015 <span class="comment">   12 bytes. Upon exit, destLen is the actual size of the compressed buffer.</span>
00016 <span class="comment"></span>
00017 <span class="comment">     compress2 returns Z_OK if success, Z_MEM_ERROR if there was not enough</span>
00018 <span class="comment">   memory, Z_BUF_ERROR if there was not enough room in the output buffer,</span>
00019 <span class="comment">   Z_STREAM_ERROR if the level parameter is invalid.</span>
00020 <span class="comment">*/</span>
00021 <span class="keywordtype">int</span> ZEXPORT compress2 (dest, destLen, source, sourceLen, level)
00022     Bytef *dest;
00023     uLongf *destLen;
00024     <span class="keyword">const</span> Bytef *source;
00025     uLong sourceLen;
00026     <span class="keywordtype">int</span> level;
00027 {
00028     z_stream stream;
00029     <span class="keywordtype">int</span> err;
00030 
00031     stream.next_in = (Bytef*)source;
00032     stream.avail_in = (uInt)sourceLen;
00033 <span class="preprocessor">#ifdef MAXSEG_64K</span>
00034 <span class="preprocessor"></span>    <span class="comment">/* Check for source &gt; 64K on 16-bit machine: */</span>
00035     <span class="keywordflow">if</span> ((uLong)stream.avail_in != sourceLen) <span class="keywordflow">return</span> Z_BUF_ERROR;
00036 <span class="preprocessor">#endif</span>
00037 <span class="preprocessor"></span>    stream.next_out = dest;
00038     stream.avail_out = (uInt)*destLen;
00039     <span class="keywordflow">if</span> ((uLong)stream.avail_out != *destLen) <span class="keywordflow">return</span> Z_BUF_ERROR;
00040 
00041     stream.zalloc = (alloc_func)0;
00042     stream.zfree = (free_func)0;
00043     stream.opaque = (voidpf)0;
00044 
00045     err = deflateInit(&amp;stream, level);
00046     <span class="keywordflow">if</span> (err != Z_OK) <span class="keywordflow">return</span> err;
00047 
00048     err = deflate(&amp;stream, Z_FINISH);
00049     <span class="keywordflow">if</span> (err != Z_STREAM_END) {
00050         deflateEnd(&amp;stream);
00051         <span class="keywordflow">return</span> err == Z_OK ? Z_BUF_ERROR : err;
00052     }
00053     *destLen = stream.total_out;
00054 
00055     err = deflateEnd(&amp;stream);
00056     <span class="keywordflow">return</span> err;
00057 }
00058 
00059 <span class="comment">/* ===========================================================================</span>
00060 <span class="comment"> */</span>
00061 <span class="keywordtype">int</span> ZEXPORT compress (dest, destLen, source, sourceLen)
00062     Bytef *dest;
00063     uLongf *destLen;
00064     <span class="keyword">const</span> Bytef *source;
00065     uLong sourceLen;
00066 {
00067     <span class="keywordflow">return</span> compress2(dest, destLen, source, sourceLen, Z_DEFAULT_COMPRESSION);
00068 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:39 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
