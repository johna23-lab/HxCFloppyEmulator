<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>adfvolinfo.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>adfvolinfo.c</h1><div class="fragment"><pre>00001 <span class="comment">/* An ADFLib function for Windows which displays a dialogue box containing details about</span>
00002 <span class="comment">** the current disk file. </span>
00003 <span class="comment">** Converted from adfVolumeInfo(), part of ADFLib by Laurent Clevy.</span>
00004 <span class="comment">**</span>
00005 <span class="comment">** Gary Harris</span>
00006 <span class="comment">** 30/8/00</span>
00007 <span class="comment">*/</span>
00008 
00009 
00010 <span class="preprocessor">#include "../adf_raw.h"</span>
00011 <span class="preprocessor">#include "../adf_util.h"</span>
00012 
00013 
00014 <span class="keywordtype">void</span> adfVolumeInfoWin(HWND hWnd, <span class="keyword">struct</span> Volume *vol)
00015 <span class="comment">/* Windows version of adfVolumeInfo().</span>
00016 <span class="comment">** Input:  Receives a handle to the window on which to display the dialogue and a pointer</span>
00017 <span class="comment">**         to an ADFLib Volume structure.</span>
00018 <span class="comment">** Output: Nil. Displays a windows dialogue containing the disk file data.</span>
00019 <span class="comment">*/</span>
00020 {
00021     <span class="keywordtype">char</span>    szTemp[50], szAdfInfo[500];     <span class="comment">/* Info string. */</span>
00022     
00023     <span class="keyword">struct  </span>bRootBlock root;
00024     <span class="keywordtype">char</span>    diskName[35];
00025     <span class="keywordtype">int</span>     days,month,year;
00026     
00027     <span class="keywordflow">if</span> (adfReadRootBlock(vol, vol-&gt;rootBlock, &amp;root)!=RC_OK)
00028         <span class="keywordflow">return</span>;
00029     
00030     memset(diskName, 0, 35);
00031     memcpy(diskName, root.diskName, root.nameLen);
00032     
00033     sprintf(szAdfInfo, <span class="stringliteral">"Name : %-30s\n"</span>, vol-&gt;volName);
00034     strcat(szAdfInfo, <span class="stringliteral">"Type : "</span>);
00035     <span class="keywordflow">switch</span>(vol-&gt;dev-&gt;devType) {
00036         <span class="keywordflow">case</span> DEVTYPE_FLOPDD:
00037             strcat(szAdfInfo, <span class="stringliteral">"Floppy Double Density : 880 KBytes\n"</span>);
00038             <span class="keywordflow">break</span>;
00039         <span class="keywordflow">case</span> DEVTYPE_FLOPHD:
00040             strcat(szAdfInfo, <span class="stringliteral">"Floppy High Density : 1760 KBytes\n"</span>);
00041             <span class="keywordflow">break</span>;
00042         <span class="keywordflow">case</span> DEVTYPE_HARDDISK:
00043             sprintf(szTemp, <span class="stringliteral">"Hard Disk partition : %3.1f KBytes\n"</span>, 
00044                 (vol-&gt;lastBlock - vol-&gt;firstBlock +1) * 512.0/1024.0);
00045             strcat(szAdfInfo, szTemp);
00046             <span class="keywordflow">break</span>;
00047         <span class="keywordflow">case</span> DEVTYPE_HARDFILE:
00048             sprintf(szTemp, <span class="stringliteral">"HardFile : %3.1f KBytes\n"</span>, 
00049                 (vol-&gt;lastBlock - vol-&gt;firstBlock +1) * 512.0/1024.0);
00050             strcat(szAdfInfo, szTemp);
00051             <span class="keywordflow">break</span>;
00052         <span class="keywordflow">default</span>:
00053             strcat(szAdfInfo, <span class="stringliteral">"Unknown devType!\n"</span>);
00054     }
00055     strcat(szAdfInfo, <span class="stringliteral">"Filesystem : "</span>);
00056     sprintf(szTemp, <span class="stringliteral">"%s "</span>,isFFS(vol-&gt;dosType) ? <span class="stringliteral">"FFS"</span> : <span class="stringliteral">"OFS"</span>);
00057     strcat(szAdfInfo, szTemp);
00058     <span class="keywordflow">if</span> (isINTL(vol-&gt;dosType))
00059         strcat(szAdfInfo, <span class="stringliteral">"INTL "</span>);
00060     <span class="keywordflow">if</span> (isDIRCACHE(vol-&gt;dosType))
00061         strcat(szAdfInfo, <span class="stringliteral">"DIRCACHE "</span>);
00062     strcat(szAdfInfo, <span class="stringliteral">"\n"</span>);
00063 
00064     sprintf(szTemp, <span class="stringliteral">"Free blocks = %ld\n"</span>, adfCountFreeBlocks(vol));
00065     strcat(szAdfInfo, szTemp);
00066     <span class="keywordflow">if</span> (vol-&gt;readOnly)
00067         strcat(szAdfInfo, <span class="stringliteral">"Read only\n"</span>);
00068     <span class="keywordflow">else</span>
00069         strcat(szAdfInfo, <span class="stringliteral">"Read/Write\n"</span>);
00070     
00071     <span class="comment">/* created */</span>
00072     adfDays2Date(root.coDays, &amp;year, &amp;month, &amp;days);
00073     sprintf(szTemp, <span class="stringliteral">"created %d/%02d/%02d %ld:%02ld:%02ld\n"</span>,days,month,year,
00074         root.coMins/60,root.coMins%60,root.coTicks/50);
00075     strcat(szAdfInfo, szTemp);
00076     adfDays2Date(root.days, &amp;year, &amp;month, &amp;days);
00077     sprintf(szTemp, <span class="stringliteral">"last access %d/%02d/%02d %ld:%02ld:%02ld,   "</span>,days,month,year,
00078         root.mins/60,root.mins%60,root.ticks/50);
00079     strcat(szAdfInfo, szTemp);
00080     adfDays2Date(root.cDays, &amp;year, &amp;month, &amp;days);
00081     sprintf(szTemp, <span class="stringliteral">"%d/%02d/%02d %ld:%02ld:%02ld\n"</span>,days,month,year,
00082         root.cMins/60,root.cMins%60,root.cTicks/50);
00083     strcat(szAdfInfo, szTemp);
00084 
00085     MessageBox(hWnd, szAdfInfo, <span class="stringliteral">"Adf Info"</span>, MB_OK);
00086 }
00087 
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:39 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
