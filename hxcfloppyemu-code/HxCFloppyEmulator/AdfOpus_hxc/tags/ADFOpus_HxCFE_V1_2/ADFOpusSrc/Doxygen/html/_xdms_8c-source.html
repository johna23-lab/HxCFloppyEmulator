<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Xdms.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>Xdms.c</h1><div class="fragment"><pre>00001 
00002 <span class="comment">/*</span>
00003 <span class="comment"> *     xDMS  v1.3  -  Portable DMS archive unpacker  -  Public Domain</span>
00004 <span class="comment"> *     Written by     "Andre Rodrigues de la Rocha"  &lt;adlroc@usa.net&gt;</span>
00005 <span class="comment"> *     Hacked to pieces by Dan Sutherland &lt;dan@chromerhino.demon.co.uk&gt;</span>
00006 <span class="comment"> *      for use in ADF Opus.</span>
00007 <span class="comment"> */</span>
00008 
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00011 <span class="preprocessor">#include &lt;string.h&gt;</span>
00012 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00013 
00014 <span class="comment">//#include "Xdms.h"</span>
00015 <span class="preprocessor">#include "cdata.h"</span>
00016 <span class="preprocessor">#include "pfile.h"</span>
00017 <span class="preprocessor">#include "crc_csum.h"</span>
00018 
00019 
00020 <span class="keywordtype">int</span> dmsUnpack(<span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> *dest)
00021 {
00022     <span class="keywordflow">return</span> Process_File(src, dest, 0, 0, 0);
00023 }
00024 
00025 <span class="keyword">static</span> <span class="keywordtype">void</span> dmsErrMsg(USHORT err, <span class="keywordtype">char</span> *i, <span class="keywordtype">char</span> *o, <span class="keywordtype">char</span> *errMess)
00026 {
00027     <span class="keywordflow">switch</span> (err) {
00028         <span class="keywordflow">case</span> NO_PROBLEM:
00029         <span class="keywordflow">case</span> DMS_FILE_END:
00030             <span class="keywordflow">return</span>;
00031         <span class="keywordflow">case</span> ERR_NOMEMORY:
00032             sprintf(errMess,<span class="stringliteral">"Not enough memory for buffers !\n"</span>);
00033             <span class="keywordflow">break</span>;
00034         <span class="keywordflow">case</span> ERR_CANTOPENIN:
00035             sprintf(errMess,<span class="stringliteral">"Can't open source file for reading\n"</span>);
00036             <span class="keywordflow">break</span>;
00037         <span class="keywordflow">case</span> ERR_CANTOPENOUT:
00038             sprintf(errMess,<span class="stringliteral">"Can't open %s for writing !\n"</span>,o);
00039             <span class="keywordflow">break</span>;
00040         <span class="keywordflow">case</span> ERR_NOTDMS:
00041             sprintf(errMess,<span class="stringliteral">"File %s is not a DMS archive !\n"</span>,i);
00042             <span class="keywordflow">break</span>;
00043         <span class="keywordflow">case</span> ERR_SREAD:
00044             sprintf(errMess,<span class="stringliteral">"Error reading file %s : unexpected end of file !\n"</span>,i);
00045             <span class="keywordflow">break</span>;
00046         <span class="keywordflow">case</span> ERR_HCRC:
00047             sprintf(errMess,<span class="stringliteral">"Error in file %s : header CRC errMessor !\n"</span>,i);
00048             <span class="keywordflow">break</span>;
00049         <span class="keywordflow">case</span> ERR_NOTTRACK:
00050             sprintf(errMess,<span class="stringliteral">"Error in file %s : track header not found !\n"</span>,i);
00051             <span class="keywordflow">break</span>;
00052         <span class="keywordflow">case</span> ERR_BIGTRACK:
00053             sprintf(errMess,<span class="stringliteral">"Error in DMS file: track too big"</span>);
00054             <span class="keywordflow">break</span>;
00055         <span class="keywordflow">case</span> ERR_THCRC:
00056             sprintf(errMess,<span class="stringliteral">"Error in file %s : track header CRC error !\n"</span>,i);
00057             <span class="keywordflow">break</span>;
00058         <span class="keywordflow">case</span> ERR_TDCRC:
00059             sprintf(errMess,<span class="stringliteral">"Error in file %s : track data CRC error !\n"</span>,i);
00060             <span class="keywordflow">break</span>;
00061         <span class="keywordflow">case</span> ERR_CSUM:
00062             sprintf(errMess,<span class="stringliteral">"Error in file %s : checksum error after unpacking !\n"</span>,i);
00063             sprintf(errMess,<span class="stringliteral">"This file seems ok, but the unpacking failed.\n"</span>);
00064             sprintf(errMess,<span class="stringliteral">"This can be caused by a bug in xDMS. Please contact the author\n"</span>);
00065             <span class="keywordflow">break</span>;
00066         <span class="keywordflow">case</span> ERR_CANTWRITE:
00067             sprintf(errMess,<span class="stringliteral">"Error : can't write to file %s  !\n"</span>,o);
00068             <span class="keywordflow">break</span>;
00069         <span class="keywordflow">case</span> ERR_BADDECR:
00070             sprintf(errMess,<span class="stringliteral">"Error in file %s : error unpacking !\n"</span>,i);
00071             sprintf(errMess,<span class="stringliteral">"This file seems ok, but the unpacking failed.\n"</span>);
00072             sprintf(errMess,<span class="stringliteral">"This can be caused by a bug in xDMS. Please contact the author\n"</span>);
00073             <span class="keywordflow">break</span>;
00074         <span class="keywordflow">case</span> ERR_UNKNMODE:
00075             sprintf(errMess,<span class="stringliteral">"Error in file %s : unknown compression mode used !\n"</span>,i);
00076             <span class="keywordflow">break</span>;
00077         <span class="keywordflow">case</span> ERR_NOPASSWD:
00078             sprintf(errMess,<span class="stringliteral">"Can't process file %s : file is encrypted !\n"</span>,i);
00079             <span class="keywordflow">break</span>;
00080         <span class="keywordflow">case</span> ERR_BADPASSWD:
00081             sprintf(errMess,<span class="stringliteral">"Error unpacking file %s . The password is probably wrong.\n"</span>,i);
00082             <span class="keywordflow">break</span>;
00083         <span class="keywordflow">case</span> ERR_FMS:
00084             sprintf(errMess,<span class="stringliteral">"Error in file %s : this file is not really a compressed disk image, but an FMS archive !\n"</span>,i);
00085             <span class="keywordflow">break</span>;
00086         <span class="keywordflow">default</span>:
00087             sprintf(errMess,<span class="stringliteral">"Error while processing file  %s : internal error !\n"</span>,i);
00088             sprintf(errMess,<span class="stringliteral">"This is a bug in xDMS\n"</span>);
00089             sprintf(errMess,<span class="stringliteral">"Please contact the author\n"</span>);
00090             <span class="keywordflow">break</span>;
00091     }
00092 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue Nov 5 12:21:43 2002 for dynlib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
